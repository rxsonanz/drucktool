<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#333333">
    <title>Druckprüfung</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #141517;
            color: #C1C2C5;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            background-color: #25262B;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            text-align: center;
        }
        h1 {
            margin-top: 0;
            color: #C1C2C5;
        }
        .cooler-box {
            border: 1px solid #373A40;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            background-color: #25262B;
        }
        .progress-bar {
            width: 100%;
            background-color: #5C5F66;
            border-radius: 5px;
            overflow: hidden;
            height: 20px;
            margin-bottom: 10px;
            display: none;
        }
        .progress-bar-inner {
            height: 100%;
            background-color: #1864AB;
            width: 0%;
        }
        .result {
            margin-top: 10px;
            text-align: left;
        }
        .result-text {
            font-size: 16px;
            margin-bottom: 5px;
        }
        .dark-mode {
            background-color: #373A40;
            color: #C1C2C5;
        }
        .success {
            background-color: #2B8A3E;
            padding: 10px;
            border-radius: 5px;
        }
        .failure {
            background-color: #E03131;
            padding: 10px;
            border-radius: 5px;
        }
        button {
            background-color: #1864AB;
            color: #C1C2C5;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        input[type="number"] {
            width: calc(100% - 22px);
            padding: 8px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #373A40;
            background-color: #25262B;
            color: #C1C2C5;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <h1>Kühler Druckprüfung</h1>
        <div id="inputsContainer">
            <!-- Generate cooler boxes dynamically -->
        </div>
    </div>

    <script>
        var coolers = [];
        var waitTime = 1;

        for (var i = 0; i < 8; i++) {
            coolers.push({ startPressure: null, progressBarInterval: null });
            createCoolerBox(i);
        }

        function createCoolerBox(coolerIndex) {
            var container = document.getElementById('inputsContainer');
            var coolerBox = document.createElement('div');
            coolerBox.className = 'cooler-box';
            coolerBox.id = 'coolerBox' + coolerIndex;
            coolerBox.innerHTML = `
                <h3>Manometer ${coolerIndex + 1}</h3>
                <div id="inputStartPressure${coolerIndex}">
                    <label for="startPressure${coolerIndex}">Startdruck (in Bar):</label>
                    <input type="number" id="startPressure${coolerIndex}" step="0.001" min="0" placeholder="z.B. 2.500">
                    <button onclick="startTest(${coolerIndex})">Start Test</button>
                </div>
                <div class="progress-bar" id="progressBar${coolerIndex}">
                    <div class="progress-bar-inner" id="progress-bar-inner${coolerIndex}"></div>
                </div>
                <div id="inputEndPressure${coolerIndex}" style="display: none;">
                    <label for="endPressure${coolerIndex}">Enddruck nach 10 Minuten (in Bar):</label>
                    <input type="number" id="endPressure${coolerIndex}" step="0.001" min="0" placeholder="z.B. 2.500">
                    <button onclick="checkPressure(${coolerIndex})">Druck überprüfen</button>
                </div>
                <div class="result" id="result${coolerIndex}" style="display: none;"></div>
                <button onclick="resetCooler(${coolerIndex})" id="resetBtn${coolerIndex}" style="display: none;">Prüfstation ${coolerIndex + 1} zurücksetzen</button>
            `;
            container.appendChild(coolerBox);
        }

        function startTest(coolerIndex) {
            var startPressure = parseFloat(document.getElementById(`startPressure${coolerIndex}`).value);
            var progressBar = document.getElementById(`progress-bar-inner${coolerIndex}`);

            if (startPressure) {
                document.getElementById(`inputStartPressure${coolerIndex}`).style.display = 'none';
                document.getElementById(`inputEndPressure${coolerIndex}`).style.display = 'none';
                document.getElementById(`result${coolerIndex}`).style.display = 'none';
                document.getElementById(`progress-bar-inner${coolerIndex}`).style.width = '0%';
                document.getElementById(`progressBar${coolerIndex}`).style.display = 'block';

                animateProgressBar(coolerIndex, waitTime * 60);

                setTimeout(function () {
                    document.getElementById(`inputEndPressure${coolerIndex}`).style.display = 'block';
                    document.getElementById(`endPressure${coolerIndex}`).focus();
                }, waitTime * 60000);
                
                coolers[coolerIndex].startPressure = startPressure;
            } else {
                alert('Bitte geben Sie den Startdruck ein.');
            }
        }

        function animateProgressBar(coolerIndex, durationInSeconds) {
            var progressBar = document.getElementById(`progress-bar-inner${coolerIndex}`);
            var startTime = Date.now();
            var endTime = startTime + (durationInSeconds * 1000);

            coolers[coolerIndex].progressBarInterval = setInterval(function () {
                var now = Date.now();
                var timeElapsed = now - startTime;
                var progress = (timeElapsed / (endTime - startTime)) * 100;

                progressBar.style.width = progress + '%';

                if (progress >= 100) {
                    clearInterval(coolers[coolerIndex].progressBarInterval);
                    document.getElementById(`progressBar${coolerIndex}`).style.display = 'none';
                    document.getElementById(`inputEndPressure${coolerIndex}`).style.display = 'block';
                    document.getElementById(`resetBtn${coolerIndex}`).style.display = 'block';
                }
            }, 1000);
        }

        function checkPressure(coolerIndex) {
            var startPressure = coolers[coolerIndex].startPressure;
            var endPressure = parseFloat(document.getElementById(`endPressure${coolerIndex}`).value);
            var resultDiv = document.getElementById(`result${coolerIndex}`);

            if (endPressure < startPressure - 0.005) {
                resultDiv.innerHTML = "<div class='failure'>Der Kühler ist undicht. Bitte manuell überprüfen!</div>";
            } else {
                resultDiv.innerHTML = "<div class='success'>Der Kühler ist dicht und kann verpackt werden.</div>";
            }

            document.getElementById('container').classList.add('dark-mode');
            resultDiv.style.display = 'block';
        }

        function resetCooler(coolerIndex) {
            clearInterval(coolers[coolerIndex].progressBarInterval);
            document.getElementById(`startPressure${coolerIndex}`).value = '';
            document.getElementById(`inputStartPressure${coolerIndex}`).style.display = 'block';
            document.getElementById(`inputEndPressure${coolerIndex}`).style.display = 'none';
            document.getElementById(`result${coolerIndex}`).style.display = 'none';
            document.getElementById(`resetBtn${coolerIndex}`).style.display = 'none';
            document.getElementById('container').classList.remove('dark-mode');
        }
    </script>
</body>
</html>
